<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guardrails Withdrawal Planner v1.9.3</title>
  <meta name="description" content="Keep spending steady in today’s money, trim safely in downturns, and recover with the market — so savings last." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg"></div>
  <header class="appbar">
    <div class="wrap row between">
      <div class="row g12">
        <div class="brand-dot"></div>
        <div>
          <div class="brand">Guardrails Withdrawal Planner</div>
          <div class="sub muted">Index‑All‑In · Guardrails · <span class="badge">v1.9.3</span></div>
        </div>
      </div>
      <div class="row g8">
        <button id="btn-export" class="btn ghost">Export (.json)</button>
        <label class="btn ghost" style="display:inline-flex;align-items:center;justify-content:center;cursor:pointer;">Import
          <input id="file-import" type="file" accept="application/json" hidden /></label>
        <button id="btn-save" class="btn ghost">Spara</button>
      </div>
    </div>
  </header>

  <main class="wrap content">
    <div id="err" class="err" hidden></div>

    <section class="grid g16">
      <div class="card kpi" style="grid-column: span 4;">
        <div class="title">Månadens total (nom)</div>
        <div class="value" id="kpi-total">—</div>
        <div class="hint">= Föreslagen real × HICP‑faktor</div>
      </div>
      <div class="card kpi" style="grid-column: span 4;">
        <div class="title">ISK‑uttag (nom)</div>
        <div class="value" id="kpi-isk">—</div>
        <div class="hint">Netto: Total − pensioner (TJP, PPM, INK)</div>
      </div>
      <div class="card kpi" style="grid-column: span 4;">
        <div class="title">Status</div>
        <div class="row g10">
          <span id="badge" class="pill">—</span>
          <span id="badge-txt" class="muted small">Ingen signal</span>
        </div>
        <div id="drawdown-line" class="tiny muted mt8"></div>
      </div>
    </section>

    <section class="grid g16">
      <div class="card" style="grid-column: span 7;">
        <div class="title-row">
          <div class="title">Dashboard – varje avstämning</div>
          <span class="chip" id="kpi-phase">Fas —</span>
        </div>
        <div class="rows">
          <div class="row between"><div class="muted">Aktuell real nivå</div><div class="mono strong" id="kpi-real-current">—</div></div>
          <div class="row between"><div class="muted">Föreslagen real nivå</div><div class="mono strong" id="kpi-real-proposed">—</div></div>
          <div class="row between"><div class="muted">Drawdown mot topp (ATH)</div><div class="mono" id="kpi-dd">—</div></div>
          <div class="row between"><div class="muted">Funding ratio (FR)</div><div class="mono" id="kpi-fr">—</div></div>
        </div>
        <div class="hr"></div>
        <div class="row g8">
          <button id="btn-commit" class="btn">Verkställ ny nivå</button>
          <button id="btn-sync" class="btn ghost">Synka ”Aktuell → Normal”</button>
          <span class="hint" id="commit-hint">Cadens: Månadsvis · Du kan ändra nu.</span>
        </div>
      </div>

      <div class="card" style="grid-column: span 5;">
        <div class="title">Guardrails (multiplikatorer per band)</div>
        <div class="row g8">
          <label>Profil
            <select id="sel-profile">
              <option value="balanced">Balanced (rekommenderad)</option>
              <option value="aggressive">Aggressive</option>
              <option value="conservative">Conservative</option>
              <option value="custom">Custom</option>
            </select>
          </label>
          <label>Välj bandmodell
            <select id="sel-bands-mode">
              <option value="bands">Diskreta band</option>
              <option value="linear">Linjär</option>
            </select>
          </label>
        </div>
        <table class="tbl">
          <thead><tr><th>DD‑intervall</th><th>Multiplikator</th><th>Real nivå</th></tr></thead>
          <tbody id="tbl-rails"></tbody>
        </table>
        <div id="custom-edit" class="mt8" hidden>
          <div class="two">
            <label>0–10 % <input id="m10" type="number" step="0.1" /></label>
            <label>10–20 % <input id="m20" type="number" step="0.1" /></label>
          </div>
          <div class="two">
            <label>20–30 % <input id="m30" type="number" step="0.1" /></label>
            <label>30–40 % <input id="m40" type="number" step="0.1" /></label>
          </div>
          <div class="two">
            <label>40–50 % <input id="m50" type="number" step="0.1" /></label>
            <label>—</label>
          </div>
        </div>
      </div>
    </section>

    <section class="grid g16">
      <div class="card" style="grid-column: span 12;">
        <div class="title">Historik (månadsvis) – ISK & Portfölj högsta</div>
        <div class="row between mt8">
          <div class="row g8">
            <label>Startmånad (YYYY‑MM)
              <input id="inp-hist-start" type="text" placeholder="2025-08" style="min-width:120px" />
            </label>
            <button id="btn-hist-update" class="btn ghost">Uppdatera historik nu</button>
            <button id="btn-hist-clear" class="btn ghost">Töm historik</button>
          </div>
          <div class="row g8"><span class="chip ghost" id="hist-meta">—</span></div>
        </div>
        <div class="hist-wrap"><canvas id="hist-canvas" width="1024" height="360"></canvas></div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
